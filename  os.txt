import os
import requests
import argparse
from yt_dlp import YoutubeDL

def download_video(url, output_path):
    ydl_opts = {
        'format': 'best',
        'outtmpl': os.path.join(output_path, '%(title)s.%(ext)s'),
        'postprocessors': [{
            'key': 'FFmpegVideoConvertor',
            'preferedformat': 'mp4',
        }],
    }

    with YoutubeDL(ydl_opts) as ydl:
        ydl.download([url])

def download_file(url, output_path):
    response = requests.get(url)
    if response.status_code == 200:
        file_name = os.path.join(output_path, os.path.basename(url))
        with open(file_name, 'wb') as file:
            file.write(response.content)
        print(f"Downloaded: {file_name}")
    else:
        print(f"Failed to download: {url} with status code {response.status_code}")

def main():
    parser = argparse.ArgumentParser(description="Download videos and files from specified URLs")
    parser.add_argument('urls', type=str, nargs='+', help='URLs to download')
    parser.add_argument('--output', type=str, default='downloads', help='Output directory for downloaded files')

    args = parser.parse_args()

    if not os.path.exists(args.output):
        os.makedirs(args.output)

    for url in args.urls:
        if url.endswith('.m3u8'):
            download_video(url, args.output)
        else:
            download_file(url, args.output)

if __name__ == "__main__":
    main()